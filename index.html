<html><head>
#mitra bar chart code
<title>INFO 4310 - hw1</title>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
</head>
<style>
body, h1 {
    font-family: 'Trebuchet MS', sans-serif;
    font-size: 20px;
}
h1 {
    font-size: 40px;
    padding: 80px;
    padding-bottom: 0;
}
input, select, button {
    font-family: 'Trebuchet MS', sans-serif;
    font-size: 20px;
}
input[type='number']{
    width: 80px;
}
.gridlines .domain {
    display: none;
}
.gridlines line {
    stroke: #9b9b9b;  
}
.filters {
    padding: 80px;
}
</style>
<body>
<h1>Average Salaries by Gender</h1>
<div class="filters">
<div>
<label>Age:</label>
<input type="number" id="age" name="age">

<label>Years of Experience:</label>
<input type="number" id="experience" name="experience">
</div>

<div>
<label>Degree:</label>
<select id="degree" name="degree">
<option selected></option>
<option value="Bachelor's">Bachelor's</option>
<option value="Master's">Master's</option>
<option value="PhD">PhD</option>
</select>

<label>Position:</label>
<input type="text" id="position" name="position" list="positionsDatalist">
<datalist id="positionsDatalist">
</datalist>

<div>
<button onclick="applyFilters()">Apply Filters</button>
</div>
</div>

<svg id="barchart" height="900" width="900" style="background: #fff; margin:50px" ></svg>
<script src="https://d3js.org/d3.v6.min.js"></script>
<script>
    const svg = d3.select("#barchart");
    const width = svg.attr("width");
    const height = svg.attr("height");
    const margin = { top: 40, right: 40, bottom: 70, left: 40}; 
    const chartWidth = width - margin.left - margin.right;
    const chartHeight = height - margin.top - margin.bottom;
    const barchart = svg.append("g")
        .attr("transform","translate("+margin.left+","+margin.top+")");
    
    let CSV; 

    async function loadCSV() {
        CSV = await d3.csv("Salary_Data.csv", d3.autoType);
        createBarChart(CSV);
        positionOptions(CSV);
    }
        
    function createBarChart(data) {
        barchart.selectAll("*").remove();
        const colorScale = d3.scaleOrdinal().domain(["Female", "Male"]).range(["#e65ddd", "#3555e2"]);

        const filteredData = data.filter(d => d['Gender'] === 'Male' || d['Gender'] === 'Female');
        const dataSplit = d3.group(filteredData, d => d['Gender']);
        const newData = Array.from(dataSplit, ([gender, salary]) => ({ Gender: gender, AverageSalary: d3.mean(salary, d => d['Salary'])}));
        
        const salaryExtent = d3.max(newData, d => d['AverageSalary']);
        const salaryScale = d3.scaleLinear().domain([0,salaryExtent]).range([chartHeight, 0]);
        
        const genders = ['Male', 'Female'];
        const genderScale = d3.scaleBand().padding(0.1).domain(genders).range([0, chartWidth]);

        //drawing bars
        barchart.selectAll('rect.bar')
                .data(newData)
                .join( enter => enter.append('rect')
                                    .attr('class','bar')
                                    .attr("fill", d => colorScale(d['Gender']))
                                    .attr("x", d => genderScale(d['Gender']))
                                    .attr("y", d => salaryScale(d['AverageSalary']))
                                    .attr("height", d =>  chartHeight - salaryScale(d['AverageSalary']))
                                    .attr("width", genderScale.bandwidth()));

        //adding labels
        barchart.selectAll('text.label')
                .data(newData)
                .join(  enter => enter.append('text')
                        .attr('class', 'label')
                        .attr("x", d => genderScale(d['Gender']) + genderScale.bandwidth() / 2)
                        .attr("y", d => salaryScale(d['AverageSalary']) - 10)
                        .attr("text-anchor", "middle") 
                        .text(d => `$${d3.format(",.2f")(d['AverageSalary'])}`) 
                        .style("font-size", "25px")); 
        barchart.selectAll('text.genderlabel')
                .data(newData)
                .join(  enter => enter.append('text')
                        .attr('class', 'label')
                        .attr("x", d => genderScale(d['Gender']) + genderScale.bandwidth() / 2)
                        .attr("y", d => salaryScale(0) + 30)
                        .attr("text-anchor", "middle") 
                        .text(d => d['Gender']) 
                        .style("font-size", "25px"));  
    }
    async function applyFilters() {
        const age = document.getElementById('age').value;
        const experience = document.getElementById('experience').value;
        const degree = document.getElementById('degree').value;
        const position = document.getElementById('position').value.toLowerCase();

        let filteredData = CSV;

        if (age != "" && age != null) {
            filteredData = filteredData.filter(d => d.Age === Number(age));
        } 
        if (experience != "" && experience != null) {
            filteredData = filteredData.filter(d => d['Years of Experience'] === Number(experience));
        } 
        if (degree != "" && degree != null) {
            filteredData = filteredData.filter(d => d['Education Level'] === degree);
        } 
        if (position != "" && position != null) {
            filteredData = filteredData.filter(d => d['Job Title'].toLowerCase().includes(position));
        } 

        createBarChart(filteredData); 
    }
    loadCSV(); 

    function positionOptions(data) {
    const uniquePositions = new Set(data.map(d => d['Job Title']).filter(title => title));;
    const positionsDatalist = document.getElementById('positionsDatalist');
    uniquePositions.forEach(d => {
        const job = document.createElement('option');
        job.value = d;
        positionsDatalist.appendChild(job);
    });
    }
</script>
</body>
</html>
